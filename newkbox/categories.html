<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Жанры Kinobox</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="container">
        <h1>Фильмы по жанрам</h1>
        <div class="filters">
            <div class="genre-select">
                <label for="genre">Выберите жанр:</label>
                <select id="genre">
                </select>
            </div>
            <div class="country-select">
                <label for="country">Выберите страну:</label>
                <select id="country">
                </select>
            </div>
            <div class="order-select">
                <label for="order">Сортировка по:</label>
                <select id="order">
                    <option value="RATING">Рейтингу</option>
                    <option value="YEAR">Году</option>
                </select>
            </div>
        </div>
        <div id="films" class="film-container">
        </div>
        <div class="pagination">
            <button id="prevPage">Предыдущая</button>
            <span id="pageNumber">Страница 1</span>
            <button id="nextPage">Следующая</button>
        </div>
    </div>

    <script>
        const genreSelect = document.getElementById('genre');
        const countrySelect = document.getElementById('country');
        const orderSelect = document.getElementById('order');
        const filmsContainer = document.getElementById('films');
        const pageNumberElement = document.getElementById('pageNumber');
        const prevPageButton = document.getElementById('prevPage');
        const nextPageButton = document.getElementById('nextPage');

        // Жанры
        const genres = [
        { id: 1, genre: "триллер" },
        { id: 2, genre: "драма" },
        { id: 3, genre: "криминал" },
        { id: 4, genre: "мелодрама" },
        { id: 5, genre: "детектив" },
        { id: 6, genre: "фантастика" },
        { id: 7, genre: "приключения" },
        { id: 8, genre: "биография" },
        { id: 9, genre: "фильм-нуар" },
        { id: 10, genre: "вестерн" },
        { id: 11, genre: "боевик" },
        { id: 12, genre: "фэнтези" },
        { id: 13, genre: "комедия" },
        { id: 14, genre: "военный" },
        { id: 15, genre: "история" },
        { id: 16, genre: "музыка" },
        { id: 17, genre: "ужасы" },
        { id: 18, genre: "мультфильм" },
        { id: 19, genre: "семейный" },
        { id: 20, genre: "мюзикл" },
        { id: 21, genre: "спорт" },
        { id: 22, genre: "документальный" },
        { id: 23, genre: "короткометражка" },
        { id: 24, genre: "аниме" },
        // { id: 25, genre: "" },
        // { id: 26, genre: "новости" },
        // { id: 27, genre: "концерт" },
        // { id: 28, genre: "для взрослых" },
        // { id: 29, genre: "церемония" },
        // { id: 30, genre: "реальное ТВ" },
        // { id: 31, genre: "игра" },
        // { id: 32, genre: "ток-шоу" },
        { id: 33, genre: "детский" }
        ];

        // Страны
        const countries = [
        { id: 1, country: "США" },
        // { id: 2, country: "Швейцария" },
        { id: 3, country: "Франция" },
        // { id: 4, country: "Польша" },
        { id: 5, country: "Великобритания" },
        { id: 6, country: "Швеция" },
        { id: 7, country: "Индия" },
        { id: 8, country: "Испания" },
        // { id: 9, country: "Германия" },
        { id: 10, country: "Италия" },
        { id: 11, country: "Гонконг" },
        { id: 12, country: "Германия (ФРГ)" },
        // { id: 13, country: "Австралия" },
        // { id: 14, country: "Канада" },
        { id: 15, country: "Мексика" },
        { id: 16, country: "Япония" },
        // { id: 17, country: "Дания" },
        // { id: 18, country: "Чехия" },
        // { id: 19, country: "Ирландия" },
        // { id: 20, country: "Люксембург" },
        { id: 21, country: "Китай" },
        { id: 22, country: "Норвегия" },
        // { id: 23, country: "Нидерланды" },
        // { id: 24, country: "Аргентина" },
        // { id: 25, country: "Финляндия" },
        // { id: 26, country: "Босния и Герцеговина" },
        // { id: 27, country: "Австрия" },
        { id: 28, country: "Тайвань" },
        // { id: 29, country: "Новая Зеландия" },
        { id: 30, country: "Бразилия" },
        { id: 31, country: "Чехословакия" },
        // { id: 32, country: "Мальта" },
        { id: 33, country: "СССР" },
        { id: 34, country: "Россия" },
        { id: 35, country: "Югославия" },
        // { id: 36, country: "Португалия" },
        // { id: 37, country: "Румыния" },
        // { id: 38, country: "Хорватия" },
        // { id: 39, country: "ЮАР" },
        // { id: 40, country: "Куба" },
        // { id: 41, country: "Колумбия" },
        // { id: 42, country: "Израиль" },
        // { id: 43, country: "Намибия" },
        { id: 44, country: "Турция" },
        // { id: 45, country: "Бельгия" },
        // { id: 46, country: "Сальвадор" },
        // { id: 47, country: "Исландия" },
        // { id: 48, country: "Венгрия" },
        { id: 49, country: "Корея Южная" },
        // { id: 50, country: "Лихтенштейн" },
        // { id: 51, country: "Болгария" },
        // { id: 52, country: "Филиппины" },
        // { id: 53, country: "Доминикана" },
        // { id: 54, country: "" },
        // { id: 55, country: "Марокко" },
        // { id: 56, country: "Таиланд" },
        // { id: 57, country: "Кения" },
        // { id: 58, country: "Пакистан" },
        // { id: 59, country: "Иран" },
        // { id: 60, country: "Панама" },
        // { id: 61, country: "Аруба" },
        // { id: 62, country: "Ямайка" },
        // { id: 63, country: "Греция" },
        // { id: 64, country: "Тунис" },
        // { id: 65, country: "Кыргызстан" },
        // { id: 66, country: "Пуэрто Рико" },
        // { id: 67, country: "Казахстан" },
        // { id: 68, country: "Югославия (ФР)" },
        // { id: 69, country: "Алжир" },
        { id: 70, country: "Германия (ГДР)" },
        // { id: 71, country: "Сингапур" },
        // { id: 72, country: "Словакия" },
        // { id: 73, country: "Афганистан" },
        // { id: 74, country: "Индонезия" },
        // { id: 75, country: "Перу" },
        // { id: 76, country: "Бермуды" },
        // { id: 77, country: "Монако" },
        // { id: 78, country: "Зимбабве" },
        // { id: 79, country: "Вьетнам" },
        // { id: 80, country: "Антильские Острова" },
        // { id: 81, country: "Саудовская Аравия" },
        // { id: 82, country: "Танзания" },
        // { id: 83, country: "Ливия" },
        // { id: 84, country: "Ливан" },
        // { id: 85, country: "Кувейт" },
        // { id: 86, country: "Египет" },
        // { id: 87, country: "Литва" },
        // { id: 88, country: "Венесуэла" },
        // { id: 89, country: "Словения" },
        // { id: 90, country: "Чили" },
        // { id: 91, country: "Багамы" },
        // { id: 92, country: "Эквадор" },
        // { id: 93, country: "Коста-Рика" },
        // { id: 94, country: "Кипр" },
        // { id: 95, country: "Уругвай" },
        // { id: 96, country: "Ирак" },
        // { id: 97, country: "Мартиника" },
        // { id: 98, country: "Эстония" },
        // { id: 99, country: "ОАЭ" }
        ];

        // Добавляем жанры в выпадающий список
        genres.forEach(genre => {
            const option = document.createElement('option');
            option.value = genre.id;
            option.textContent = genre.genre;
            genreSelect.appendChild(option);
        });

        // Добавляем страны в выпадающий список
        countries.forEach(country => {
            const option = document.createElement('option');
            option.value = country.id;
            option.textContent = country.country;
            countrySelect.appendChild(option);
        });

        // Установка начальных значений
        let currentPage = 1;

        // Обработка выбора жанра
        genreSelect.addEventListener('change', () => {
            fetchFilms();
        });

        // Обработка выбора страны
        countrySelect.addEventListener('change', () => {
            fetchFilms();
        });

        // Обработка выбора сортировки
        orderSelect.addEventListener('change', () => {
            fetchFilms();
        });

        // Обработка нажатия кнопок страниц
        prevPageButton.addEventListener('click', () => {
            if (currentPage > 1) {
                currentPage--;
                fetchFilms();
            }
        });

        nextPageButton.addEventListener('click', () => {
            currentPage++;
            fetchFilms();
        });

        // Функция для получения фильмов
        function fetchFilms() {
            const genreId = genreSelect.value;
            const countryId = countrySelect.value;
            const order = orderSelect.value;
            const apiUrl = `https://kinopoiskapiunofficial.tech/api/v2.2/films?genres=${genreId}&order=${order}&type=ALL&ratingFrom=0&ratingTo=10&yearFrom=1000&yearTo=3000&page=${currentPage}${countryId ? `&countries=${countryId}` : ''}`;

            fetch(apiUrl, {
                headers: {
                    'Content-Type': 'application/json',
                    'X-API-KEY': '778c4001-18d0-4e13-8699-6b398f196b1a' // Замените на ваш реальный ключ
                }
            })
            .then(response => response.json())
            .then(data => {
                console.log('Ответ от API:', data); // Логируем ответ для отладки
                const films = data.items || [];
                displayFilms(films);
                updatePagination(data.totalPages);
            })
            .catch(error => {
                console.error('Ошибка при получении данных:', error);
                filmsContainer.innerHTML = '<p>Ошибка при получении данных.</p>';
            });
        }

        // Функция для отображения фильмов
        function displayFilms(films) {
            filmsContainer.innerHTML = '';
            if (!Array.isArray(films) || films.length === 0) {
                filmsContainer.innerHTML = '<p>Нет фильмов для выбранных фильтров.</p>';
                return;
            }
            films.forEach(film => {
                const filmElement = document.createElement('a');
                filmElement.href = `film.html?id=${film.kinopoiskId}`;
                filmElement.className = 'film';
                filmElement.innerHTML = `
                    <img src="${film.posterUrlPreview}" alt="${film.nameRu || 'Без названия'}">
                    <p>${film.nameRu || 'Без названия'}</p>
                    <p class="film__rating">${film.ratingKinopoisk || 'Не указан'}</p>
                    <p class="film__year">${film.year || 'Не указан'}</p>
                `;
                // Установка фона для .film__rating, если рейтинг >= 8
                const ratingElement = filmElement.querySelector('.film__rating');
                if (film.ratingKinopoisk !== null && !isNaN(film.ratingKinopoisk)) {
                    const ratingValue = parseFloat(film.ratingKinopoisk);
                    if (ratingValue >= 8) {
                        ratingElement.style.backgroundColor = '#00ff0080'; // Зеленый
                    } else if (ratingValue > 7) {
                        ratingElement.style.backgroundColor = '#FF8C0080'; // Оранжевый
                    } else {
                        ratingElement.style.backgroundColor = '#ff000080'; // Красный
                    }
                } else {
                    ratingElement.style.display = 'none';
                }
                filmsContainer.appendChild(filmElement);
            });
        }

        // Функция для обновления навигации по страницам
        function updatePagination(totalPages) {
            pageNumberElement.textContent = `Страница ${currentPage}`;
            prevPageButton.disabled = currentPage <= 1;
            nextPageButton.disabled = currentPage >= totalPages;
        }
    </script>
</body>
</html>